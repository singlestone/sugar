# Set name of workflow in GitHub Actions
name: CI

# What triggers this workflow
on:
  pull_request:
    branches:
      - main

# Define jobs within the workflow
jobs:
  # Define a job
  test:
    name: Test on Node 16.x
    runs-on: ubuntu-latest
    # To use Remote Caching, uncomment the next lines and follow the steps below.
    env:
      TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}
      TURBO_TEAM: ${{ secrets.TURBO_TEAM }}
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
        with:
          # fetch the entire git history
          fetch-depth: "0"

      - name: Install Dependencies via pnpm
        uses: ToppleTheNun/action-pnpm-install@v1
        with:
          version: 7.9.0

      - name: Build changed packages
        run: pnpm build:changed

      - name: Test changed packages
        run: pnpm test:ci:changed

      - name: Test changed Storybooks
        run: pnpm test-storybook:ci:changed
